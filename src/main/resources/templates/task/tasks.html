<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‘ì—… ì¼ì • ê´€ë¦¬</title>
    <style>
        @import url('//fonts.googleapis.com/earlyaccess/notosanskr.css');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'notosanskr', sans-serif;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            display: flex;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        /* ì™¼ìª½ ë‹¬ë ¥ ì˜ì—­ */
        .calendar-section {
            margin-top: 7vh;
            flex: 1;
            min-width: 600px;
            padding: 20px;
            border-right: 2px solid #e1e8ed;
            overflow-y: auto;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #f8f9fa;
            color: #495057;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .calendar-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .view-controls {
            display: flex;
            gap: 5px;
        }

        .view-btn {
            padding: 8px 16px;
            border: 2px solid #e1e8ed;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border-color: transparent;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        /* ì›”ê°„ ë‹¬ë ¥ */
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar .selected-date {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.3) 0%, rgba(68, 160, 141, 0.3) 100%);
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.4);
            transform: scale(1.02);
        }

        .calendar th,
        .calendar td {
            width: 14.28%;
            height: 80px;
            border: 1px solid #e1e8ed;
            vertical-align: top;
            position: relative;
            padding: 5px;
        }

        .calendar th {
            background: #f8f9fa;
            height: 40px;
            text-align: center;
            font-weight: 600;
            color: #6c757d;
        }

        .calendar td {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar td:hover:not(.other-month) {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.05);
        }

        .calendar .date-number {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .calendar td::after {
            content: 'ë”ë¸”í´ë¦­í•˜ì—¬ ì‘ì—… ì¶”ê°€';
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .calendar td::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid rgba(0, 0, 0, 0.9);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .calendar td:hover::after,
        .calendar td:hover::before {
            opacity: 1;
        }

        .calendar .other-month {
            color: #ccc;
            background: #fafafa;
        }

        .calendar .today {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
        }

        .calendar .has-tasks {
            border-left: 4px solid #4ecdc4;
        }

        .task-indicator {
            display: block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin: 1px;
            float: left;
        }

        .task-indicator.priority-low {
            background: #28a745;
        }

        .task-indicator.priority-medium {
            background: #ffc107;
        }

        .task-indicator.priority-high {
            background: #fd7e14;
        }

        .task-indicator.priority-urgent {
            background: #dc3545;
        }

        /* ë‹¬ë ¥ì˜ ì™„ë£Œëœ ì‘ì—… ì¸ë””ì¼€ì´í„° */
        .task-indicator.completed {
            background: #dee2e6 !important;
            opacity: 0.6;
        }

        /* ì£¼ê°„/ë…„ê°„ ë‹¬ë ¥ì˜ ì™„ë£Œëœ ì‘ì—… ì´ë²¤íŠ¸ */
        .task-event.completed {
            background: rgba(222, 226, 230, 0.3) !important;
            border-left: 3px solid #dee2e6 !important;
            color: #6c757d !important;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .task-event.completed:hover {
            background: rgba(222, 226, 230, 0.5) !important;
            opacity: 0.85;
        }

        .mini-calendar .has-tasks.priority-low {
            border: 2px solid #28a745 !important;
        }

        .mini-calendar .has-tasks.priority-medium {
            border: 2px solid #ffc107 !important;
        }

        .mini-calendar .has-tasks.priority-high {
            border: 2px solid #fd7e14 !important;
        }

        .mini-calendar .has-tasks.priority-urgent {
            border: 2px solid #dc3545 !important;
        }

        .mini-calendar .has-tasks.priority-low:hover {
            background-color: rgba(40, 167, 69, 0.25) !important;
        }

        .mini-calendar .has-tasks.priority-medium:hover {
            background-color: rgba(255, 193, 7, 0.25) !important;
        }

        .mini-calendar .has-tasks.priority-high:hover {
            background-color: rgba(253, 126, 20, 0.25) !important;
        }

        .mini-calendar .has-tasks.priority-urgent:hover {
            background-color: rgba(220, 53, 69, 0.25) !important;
        }

        /* ë…„ê°„ ë‹¬ë ¥ì˜ ì™„ë£Œëœ ì‘ì—…ì´ ìˆëŠ” ë‚ ì§œ */
        .mini-calendar .has-tasks.has-completed-only {
            background-color: rgba(222, 226, 230, 0.2) !important;
            border: 1px solid #dee2e6 !important;
        }

        .mini-calendar .has-tasks.has-completed-only:hover {
            background-color: rgba(222, 226, 230, 0.4) !important;
        }

        .mini-calendar .task-dot.priority-low {
            background: #28a745 !important;
        }

        .mini-calendar .task-dot.priority-medium {
            background: #ffc107 !important;
        }

        .mini-calendar .task-dot.priority-high {
            background: #fd7e14 !important;
        }

        .mini-calendar .task-dot.priority-urgent {
            background: #dc3545 !important;
        }

        /* ì—¬ëŸ¬ ìš°ì„ ìˆœìœ„ê°€ ì„ì—¬ìˆì„ ë•Œ ìµœê³  ìš°ì„ ìˆœìœ„ë¡œ í‘œì‹œ */
        .mini-calendar .has-tasks.mixed-priority {
            border: 2px solid #6c757d !important;
            background-color: rgba(108, 117, 125, 0.1) !important;
        }

        .mini-calendar .has-tasks.mixed-priority:hover {
            background-color: rgba(108, 117, 125, 0.25) !important;
        }

        .mini-calendar .task-dot.mixed-priority {
            background: linear-gradient(45deg, #28a745, #ffc107, #fd7e14, #dc3545) !important;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì  í‘œì‹œ */
        .mini-calendar .task-dot.completed {
            background: #dee2e6 !important;
        }

        /* ì»¤ìŠ¤í…€ íˆ´íŒì—ì„œ ì™„ë£Œëœ ì‘ì—… */
        .tooltip-task.completed {
            color: #6c757d !important;
            text-decoration: line-through;
            opacity: 0.7;
        }

        /* ì£¼ê°„ ë‹¬ë ¥ */
        .week-calendar {
            display: none;
        }

        .week-calendar.active {
            display: block;
        }

        .week-header {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            margin-bottom: 1px;
        }

        .week-header div {
            background: #f8f9fa;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #6c757d;
        }

        .week-body {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            height: 400px;
        }

        .time-slot {
            background: #f8f9fa;
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
            color: #6c757d;
            border-bottom: 1px solid #e1e8ed;
        }

        .day-column {
            border: 1px solid #e1e8ed;
            background: white;
            position: relative;
        }

        .day-column.today {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(68, 160, 141, 0.1) 100%);
        }

        /* ë…„ê°„ ë‹¬ë ¥ */
        .year-calendar {
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .year-calendar.active {
            display: grid;
        }

        .mini-month {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }

        .mini-month-title {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mini-month-title:hover {
            color: #4ecdc4;
            transform: scale(1.05);
        }

        .mini-calendar {
            width: 100%;
            font-size: 0.8rem;
        }

        .mini-calendar td {
            width: 14.28%;
            height: 25px;
            text-align: center;
            padding: 2px;
            border: none;
        }

        .mini-calendar .today {
            background: #4ecdc4;
            color: white;
            border-radius: 50%;
        }

        .mini-calendar .has-tasks {
            background-color: rgba(78, 205, 196, 0.1);
            border: 1px solid #4ecdc4;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mini-calendar .has-tasks:hover {
            background-color: rgba(78, 205, 196, 0.3) !important;
            transform: scale(1.1);
            border-radius: 4px;
        }

        .mini-calendar .task-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 4px;
            height: 4px;
            background: #4ecdc4;
            border-radius: 50%;
        }

        .mini-calendar td {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mini-calendar td:hover:not(.other-month) {
            background-color: rgba(78, 205, 196, 0.2);
        }

        .mini-calendar .today.has-tasks {
            background: #4ecdc4;
            color: white;
            position: relative;
        }

        .mini-calendar .today .task-dot {
            background: white;
        }

        .tasks-section {
            margin-top: 7vh;
            flex: 1;
            min-width: 400px;
            padding: 20px;
            overflow-y: auto;
        }

        .tasks-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .tasks-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .task-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sort-select, .filter-select {
            padding: 8px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
            background: white;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #7f8c8d, #6c7a7b);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
        }

        /* í…Œì´ë¸” í˜•ì‹ ì‘ì—… ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .task-list {
            display: block;
        }

        .task-table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .task-table thead {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .task-table th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* í…Œì´ë¸” í—¤ë” ì»¬ëŸ¼ ë„ˆë¹„ (7ê°œ ì»¬ëŸ¼) */
        .th-title { width: 30%; }
        .th-author { width: 12%; }
        .th-date { width: 18%; }
        .th-priority {
            width: 12%;
        }
        .th-status {
            width: 12%;
        }
        .th-overdue {
            width: 8%;
        }
        .th-actions {
            width: 8%;
            text-align: center;
        }

        .task-row {
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .task-row:hover {
            background: rgba(78, 205, 196, 0.05);
        }

        .task-row:last-child {
            border-bottom: none;
        }
        /* ì™„ë£Œëœ ì‘ì—… í–‰ ì „ì²´ ìŠ¤íƒ€ì¼ */
        .task-row.completed {
            background-color: #f8f9fa !important;
            color: #6c757d;
            opacity: 0.7;
        }

        .task-row.completed:hover {
            background-color: #e9ecef !important;
            opacity: 0.85;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì œëª©ê³¼ ì„¤ëª… */
        .task-row.completed .task-title {
            color: #6c757d !important;
            text-decoration: line-through;
        }

        .task-row.completed .task-description {
            color: #adb5bd !important;
            text-decoration: line-through;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì‘ì„±ì */
        .task-row.completed .task-author-cell {
            color: #adb5bd !important;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ë‚ ì§œ */
        .task-row.completed .task-date-cell {
            color: #adb5bd !important;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ìš°ì„ ìˆœìœ„ ë°°ì§€ */
        .task-row.completed .priority-badge {
            background-color: #e9ecef !important;
            color: #6c757d !important;
            opacity: 0.8;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì§€ì—° ìƒíƒœ ë°°ì§€ë„ íšŒìƒ‰ìœ¼ë¡œ */
        .task-row.completed .overdue-badge {
            background-color: #e9ecef !important;
            color: #6c757d !important;
        }

        .task-row.completed .on-time-badge {
            background-color: #e9ecef !important;
            color: #6c757d !important;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì•¡ì…˜ ë²„íŠ¼ë“¤ */
        .task-row.completed .btn-small {
            opacity: 0.6;
        }

        /* ì™„ë£Œëœ ì‘ì—…ì˜ ì¢Œì¸¡ ìš°ì„ ìˆœìœ„ í…Œë‘ë¦¬ë„ íšŒìƒ‰ìœ¼ë¡œ */
        .task-row.completed.priority-low,
        .task-row.completed.priority-medium,
        .task-row.completed.priority-high,
        .task-row.completed.priority-urgent {
            border-left: 3px solid #dee2e6 !important;
        }

        .task-row.priority-low {
            border-left: 3px solid #28a745;
        }

        .task-row.priority-medium {
            border-left: 3px solid #ffc107;
        }

        .task-row.priority-high {
            border-left: 3px solid #fd7e14;
        }

        .task-row.priority-urgent {
            border-left: 3px solid #dc3545;
        }

        .task-row.overdue {
            background: rgba(231, 76, 60, 0.05);
        }

        .task-table td {
            padding: 10px 8px;
            vertical-align: middle;
        }

        .task-title-cell {
            max-width: 0;
        }

        .task-title-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .task-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .task-description {
            color: #7f8c8d;
            font-size: 0.7rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            opacity: 0.8;
            max-width: 100%;
        }

        .task-author-cell {
            color: #7f8c8d;
            font-size: 0.85rem;
        }

        .task-date-cell {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .task-dates {
            display: flex;
            flex-direction: column;
            gap: 1px;
            line-height: 1.3;
        }

        .task-priority-cell {
        }

        .task-status-cell {
        }

        .task-overdue-cell {
        }

        .priority-badge, .status-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
            display: inline-block;
        }

        .priority-low {
            background: #d4edda;
            color: #155724;
        }

        .priority-medium {
            background: #fff3cd;
            color: #856404;
        }

        .priority-high {
            background: #ffe8d4;
            color: #b45309;
        }

        .priority-urgent {
            background: #f8d7da;
            color: #721c24;
        }

        .status-todo {
            background: #ecf0f1;
            color: #95a5a6;
        }

        .status-in-progress {
            background: #fef9e7;
            color: #f39c12;
        }

        .status-completed {
            background: #eafaf1;
            color: #27ae60;
        }

        .on-time-badge {
            background: #eafaf1;
            color: #27ae60;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .overdue-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .task-actions-cell {
            text-align: center;
        }

        .task-actions {
            display: flex;
            gap: 3px;
            justify-content: center;
            align-items: center;
        }

        .btn-small {
            padding: 4px 6px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 24px;
        }

        .btn-edit {
            background: #e3f2fd;
            color: #1976d2;
        }

        .btn-edit:hover {
            background: #bbdefb;
            transform: scale(1.1);
        }

        .btn-delete {
            background: #ffebee;
            color: #d32f2f;
        }

        .btn-delete:hover {
            background: #ffcdd2;
            transform: scale(1.1);
        }

        .btn-complete {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .btn-complete:hover {
            background: #c8e6c9;
            transform: scale(1.1);
        }

        .period-header {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .period-header h3 {
            font-size: 1rem;
            margin: 0;
        }

        .task-row:hover .task-title {
            color: #4ecdc4;
        }

        .task-row:hover .priority-badge,
        .task-row:hover .status-badge,
        .task-row:hover .overdue-badge,
        .task-row:hover .on-time-badge {
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .show-all-btn {
            background: #f8f9fa;
            color: #6c757d;
            border: 2px solid #e9ecef;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .show-all-btn:hover {
            background: #e9ecef;
            color: #495057;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999; /* 1000ì—ì„œ 9999ë¡œ ë³€ê²½ */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            position: relative; /* ì¶”ê°€ */
            z-index: 10000; /* ì¶”ê°€ */
        }

        .modal-form-container {
            display: grid;
            grid-template-columns: 380px 1fr; /* 400pxì—ì„œ 380pxë¡œ ì¤„ì„ */
            gap: 25px; /* 30pxì—ì„œ 25pxë¡œ ì¤„ì„ */
        }

        .modal-left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-right-column {
            display: flex;
            flex-direction: column;
            padding-right: 0; /* ìš°ì¸¡ ì—¬ë°± ì œê±° */
        }

        .form-group.full-height {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin: 0; /* ê¸°ë³¸ margin ì œê±° */
        }

        .form-group.full-height .form-textarea {
            flex: 1;
            min-height: 450px;
            resize: none;
            width: 100%; /* ëª…ì‹œì ìœ¼ë¡œ 100% ì„¤ì • */
            box-sizing: border-box; /* padding í¬í•¨í•œ í¬ê¸° ê³„ì‚° */
        }

        .modal-actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        /* ë°˜ì‘í˜• - ì‘ì€ í™”ë©´ì—ì„œëŠ” 1ì—´ë¡œ */
        @media (max-width: 768px) {
            .modal-form-container {
                grid-template-columns: 1fr;
            }

            .modal-right-column {
                min-height: 200px;
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            outline: none;
            transition: all 0.3s ease;
            font-size: 14px;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .category-dropdown-container {
            position: relative;
        }

        .category-dropdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .category-dropdown-header:hover {
            border-color: #4ecdc4;
            background: #f8f9fa;
        }

        .category-dropdown-header.active {
            border-color: #4ecdc4;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .category-selected-display {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            color: #6c757d;
        }

        .category-selected-count {
            background: #4ecdc4;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .category-dropdown-arrow {
            transition: transform 0.3s ease;
            color: #6c757d;
            font-size: 1.2rem;
        }

        .category-dropdown-arrow.open {
            transform: rotate(180deg);
        }

        .category-checkbox-container {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border: 2px solid #4ecdc4;
            border-top: none;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            position: absolute;
            width: 100%;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .category-checkbox-container.open {
            display: flex; /* ì—´ë¦´ ë•Œë§Œ í‘œì‹œ */
        }

        .category-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8f9fa;
        }

        .category-checkbox-item:hover {
            background: #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .category-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .category-checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            flex: 1;
        }

        .category-color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .category-checkbox-item.selected {
            background: rgba(78, 205, 196, 0.15);
            border-left: 3px solid #4ecdc4;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: slideInRight 0.3s ease;
            color: white;
            font-weight: 500;
        }

        .notification.success {
            background: linear-gradient(45deg, #4caf50, #45a049);
        }

        .notification.error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        .notification.warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .task-event {
            background: rgba(78, 205, 196, 0.1);
            border-left: 3px solid #4ecdc4;
            padding: 2px 5px;
            margin: 1px 0;
            font-size: 0.7rem;
            cursor: pointer;
            border-radius: 3px;
        }

        .task-event:hover {
            background: rgba(78, 205, 196, 0.2);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #e1e8ed;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #f8f9fa;
        }

        .pagination button.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border-color: transparent;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ì»¤ìŠ¤í…€ íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .custom-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            max-width: 300px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.2s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .custom-tooltip::before {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(0, 0, 0, 0.9);
        }

        .tooltip-header {
            font-weight: 600;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: #4ecdc4;
        }

        .tooltip-task {
            padding: 4px 0;
            line-height: 1.4;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tooltip-task:last-child {
            border-bottom: none;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ ìˆ˜ì • - íƒœë¸”ë¦¿ìš© */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                height: auto;
            }

            .calendar-section {
                min-width: auto;
                border-right: none;
                border-bottom: 2px solid #e1e8ed;
            }

            .tasks-section {
                min-width: auto;
            }

            .th-title { width: 35%; }
            .th-author { width: 0; }
            .th-date { width: 20%; }
            .th-priority { width: 15%; }
            .th-status { width: 15%; }
            .th-overdue { width: 10%; }
            .th-actions { width: 5%; }

            .task-author-cell,
            .task-table th:nth-child(2) {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .calendar-header {
                flex-direction: column;
                gap: 15px;
            }

            .calendar-nav {
                flex-wrap: wrap;
            }

            .task-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .calendar th,
            .calendar td {
                height: 60px;
                font-size: 0.8rem;
            }

            .task-table {
                font-size: 0.75rem;
            }

            .task-table th {
                padding: 6px 3px;
                font-size: 0.7rem;
            }

            .task-table td {
                padding: 6px 3px;
            }

            .th-title { width: 40%; }
            .th-author { width: 0; } /* ëª¨ë°”ì¼ì—ì„œ ì‘ì„±ì ìˆ¨ê¹€ */
            .th-date { width: 25%; }
            .th-priority { width: 12%; }
            .th-status { width: 12%; }
            .th-overdue { width: 8%; }
            .th-actions { width: 3%; }

            /* ëª¨ë°”ì¼ì—ì„œ ì‘ì„±ì ì»¬ëŸ¼ ìˆ¨ê¹€ */
            .task-author-cell,
            .task-table th:nth-child(2) {
                display: none;
            }

            .task-dates {
                font-size: 0.65rem;
            }

            .priority-badge, .status-badge, .overdue-badge, .on-time-badge {
                font-size: 0.55rem;
                padding: 1px 4px;
            }

            .btn-small {
                min-width: 18px;
                height: 18px;
                font-size: 0.55rem;
                padding: 2px 4px;
            }
        }

        @media (max-width: 480px) {
            .task-meta {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .calendar td::after {
                font-size: 0.6rem;
                padding: 4px 6px;
            }

            .th-title { width: 45%; }
            .th-date { width: 0; } /* ì´ˆì†Œí˜•ì—ì„œ ë‚ ì§œë„ ìˆ¨ê¹€ */
            .th-priority { width: 20%; }
            .th-status { width: 20%; }
            .th-overdue { width: 10%; }
            .th-actions { width: 5%; }

            /* ì´ˆì†Œí˜•ì—ì„œ ë‚ ì§œ ì»¬ëŸ¼ë„ ìˆ¨ê¹€ */
            .task-date-cell,
            .task-table th:nth-child(3) {
                display: none;
            }

            .task-actions {
                flex-direction: column;
                gap: 1px;
            }

            .btn-small {
                min-width: 16px;
                height: 16px;
                font-size: 0.5rem;
            }

            .priority-badge, .status-badge, .overdue-badge, .on-time-badge {
                font-size: 0.5rem;
                padding: 1px 3px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- ì™¼ìª½ ë‹¬ë ¥ ì˜ì—­ -->
    <div class="calendar-section">
        <div class="calendar-header">
            <div class="calendar-nav">
                <button class="nav-btn" onclick="navigateCalendar(-1)">â—€ ì´ì „</button>
                <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
                <button class="nav-btn" onclick="navigateCalendar(1)">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-title" id="calendarTitle">2025ë…„ 6ì›”</div>
            <div class="view-controls">
                <button class="view-btn" onclick="changeView('week')">ì£¼ê°„</button>
                <button class="view-btn active" onclick="changeView('month')">ì›”ê°„</button>
                <button class="view-btn" onclick="changeView('year')">ë…„ê°„</button>
            </div>
        </div>

        <div class="calendar-container">
            <!-- ì›”ê°„ ë‹¬ë ¥ -->
            <div id="monthView" class="month-calendar">
                <table class="calendar" id="monthCalendar">
                    <thead>
                    <tr>
                        <th>ì¼</th>
                        <th>ì›”</th>
                        <th>í™”</th>
                        <th>ìˆ˜</th>
                        <th>ëª©</th>
                        <th>ê¸ˆ</th>
                        <th>í† </th>
                    </tr>
                    </thead>
                    <tbody id="monthCalendarBody">
                    <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>

            <!-- ì£¼ê°„ ë‹¬ë ¥ -->
            <div id="weekView" class="week-calendar">
                <div class="week-header">
                    <div>ì‹œê°„</div>
                    <div>ì¼</div>
                    <div>ì›”</div>
                    <div>í™”</div>
                    <div>ìˆ˜</div>
                    <div>ëª©</div>
                    <div>ê¸ˆ</div>
                    <div>í† </div>
                </div>
                <div class="week-body" id="weekCalendarBody">
                    <!-- ì£¼ê°„ ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë…„ê°„ ë‹¬ë ¥ -->
            <div id="yearView" class="year-calendar">
                <!-- 12ê°œì›” ë¯¸ë‹ˆ ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì‘ì—… ëª©ë¡ ì˜ì—­ -->
    <div class="tasks-section">
        <div class="tasks-header">
            <h2 class="tasks-title">ğŸ“‹ ì‘ì—… ëª©ë¡</h2>
            <div>
                <button class="btn btn-secondary" onclick="location.href='/tasks/category'">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</button>
                <button class="btn btn-primary" onclick="openTaskModal()">â• ìƒˆ ì‘ì—…</button>
            </div>
        </div>

        <div class="task-controls">
            <select id="sortSelect" class="sort-select" onchange="sortTasks()">
                <option value="endDate">ë§Œë£Œì¼ ìˆœ</option>
                <option value="priority">ìš°ì„ ë„ ìˆœ</option>
                <option value="createdAt">ë“±ë¡ì¼ ìˆœ</option>
            </select>
            <select id="statusFilter" class="filter-select" onchange="filterTasks()">
                <option value="">ëª¨ë“  ìƒíƒœ</option>
                <option value="TODO">í•  ì¼</option>
                <option value="IN_PROGRESS">ì§„í–‰ ì¤‘</option>
                <option value="TODO,IN_PROGRESS">í•  ì¼ + ì§„í–‰ ì¤‘</option>
                <option value="COMPLETED">ì™„ë£Œ</option>
            </select>
            <select id="priorityFilter" class="filter-select" onchange="filterTasks()">
                <option value="">ëª¨ë“  ìš°ì„ ìˆœìœ„</option>
                <option value="LOW">ë‚®ìŒ</option>
                <option value="MEDIUM">ë³´í†µ</option>
                <option value="HIGH">ë†’ìŒ</option>
                <option value="URGENT">ê¸´ê¸‰</option>
            </select>
            <button class="show-all-btn" onclick="showAllTasks()">ğŸ“‹ ì „ì²´ ì‘ì—… ë³´ê¸°</button>
        </div>

        <div class="task-list" id="taskList">
            <!-- ì‘ì—… ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <div class="pagination" id="pagination" style="display: none;">
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“</div>
            <h3>ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìƒˆ ì‘ì—… ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‘ì—…ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
        </div>
    </div>
</div>

<!-- ì‘ì—… ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeTaskModal()">&times;</span>
        <h2 id="modalTitle">ìƒˆ ì‘ì—… ë“±ë¡</h2>
        <form id="taskForm" onsubmit="saveTask(event)">
            <input type="hidden" id="taskId">

            <div class="modal-form-container">
                <div class="modal-left-column">
                    <div class="form-group">
                        <label class="form-label" for="title">ì‘ì—… ì œëª© *</label>
                        <input type="text" id="title" class="form-input" required maxlength="200">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="startDate">ì‹œì‘ì¼ *</label>
                        <input type="date" id="startDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="endDate">ì¢…ë£Œì¼ *</label>
                        <input type="date" id="endDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="priority">ìš°ì„ ìˆœìœ„</label>
                        <select id="priority" class="form-select">
                            <option value="LOW">ë‚®ìŒ</option>
                            <option value="MEDIUM" selected>ë³´í†µ</option>
                            <option value="HIGH">ë†’ìŒ</option>
                            <option value="URGENT">ê¸´ê¸‰</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="status">ìƒíƒœ</label>
                        <select id="status" class="form-select">
                            <option value="TODO">í•  ì¼</option>
                            <option value="IN_PROGRESS">ì§„í–‰ ì¤‘</option>
                            <option value="COMPLETED">ì™„ë£Œ</option>
                        </select>
                    </div>

                    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ì¶”ê°€ -->
                    <div class="form-group">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                        <div class="category-dropdown-container">
                            <div class="category-dropdown-header" onclick="toggleCategoryDropdown()">
                                <div class="category-selected-display">
                                    <span id="categorySelectedText">ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì—†ìŒ</span>
                                    <span id="categorySelectedCount" class="category-selected-count" style="display: none;">0</span>
                                </div>
                                <span class="category-dropdown-arrow">â–¼</span>
                            </div>
                            <div id="categoryCheckboxList" class="category-checkbox-container">
                                <!-- ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-right-column">
                    <div class="form-group full-height">
                        <label class="form-label" for="description">ì‘ì—… ì„¤ëª…</label>
                        <textarea id="description" class="form-textarea" maxlength="1000"></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn" onclick="closeTaskModal()"
                            style="background: #f8f9fa; color: #6c757d;">ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div id="sidebar-container"></div>
<script>
    fetch("/infra/sidebar.html")
        .then(res => res.text())
        .then(html => {
            document.getElementById("sidebar-container").innerHTML = html;
        })
</script>
<script>
    // ì „ì—­ ë³€ìˆ˜
    let tasks = [];
    let categories = [];
    let currentDate = new Date();
    let currentView = 'month';
    let editingTaskId = null;
    let selectedDate = null;
    let currentPage = 0;
    let totalPages = 0;
    const PAGE_SIZE = 10;

    // API ê¸°ë³¸ URL
    const API_BASE_URL = '/api/tasks';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function () {
        loadCategories();
        loadTasks();
        renderCalendar();
        setDefaultDates();

        // ì „ì—­ í´ë¦­ ì´ë²¤íŠ¸ë¡œ íˆ´íŒ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.custom-tooltip') && !e.target.closest('.has-tasks')) {
                removeCustomTooltip();
            }
        });

        // ìŠ¤í¬ë¡¤ ì‹œ íˆ´íŒ ìˆ¨ê¸°ê¸°
        document.addEventListener('scroll', () => {
            removeCustomTooltip();
        });
    });

    // API í˜¸ì¶œ í•¨ìˆ˜ë“¤
    async function apiRequest(url, options = {}) {
        try {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            const response = await fetch(url, { ...defaultOptions, ...options });

            if (!response.ok) {
                const errorData = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorData}`);
            }

            // ë¹ˆ ì‘ë‹µ ì²˜ë¦¬ (204 No Content ë“±)
            if (response.status === 204 || response.headers.get('content-length') === '0') {
                return null;
            }

            return await response.json();
        } catch (error) {
            console.error('API ìš”ì²­ ì‹¤íŒ¨:', error);
            showNotification(`API ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            throw error;
        }
    }

    async function loadCategories() {
        try {
            const response = await fetch('/api/task-categories');
            const data = await response.json();
            categories = data.categories || [];
        } catch (error) {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
    }


    async function loadTasks() {
        try {
            showLoading(true);

            // í˜„ì¬ ë·°ì— ë”°ë¥¸ ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
            const dateRange = getCurrentViewDateRange();
            const startDateStr = formatDateForApi(dateRange.start);
            const endDateStr = formatDateForApi(dateRange.end);

            // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;

            // í˜„ì¬ ë·°ì— ë”°ë¥¸ size ê²°ì •
            let size;
            if (currentView === 'month') {
                size = 100; // ì›”ê°„ì€ ìµœëŒ€ 100ê°œ
            } else if (currentView === 'week') {
                size = 50; // ì£¼ê°„ì€ ìµœëŒ€ 50ê°œ
            } else {
                size = 1000; // ë…„ê°„ì€ ìµœëŒ€ 1000ê°œ
            }

            // URL êµ¬ì„±
            let url = `${API_BASE_URL}/search?startDate=${startDateStr}&endDate=${endDateStr}&page=${currentPage}&size=${size}`;

            // ìƒíƒœ í•„í„° ì¶”ê°€
            if (statusFilter) {
                if (statusFilter.includes(',')) {
                    // ì—¬ëŸ¬ ìƒíƒœì¸ ê²½ìš° ê°ê° status íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€
                    const statuses = statusFilter.split(',');
                    statuses.forEach(status => {
                        url += `&status=${status.trim()}`;
                    });
                } else {
                    // ë‹¨ì¼ ìƒíƒœì¸ ê²½ìš°
                    url += `&status=${statusFilter}`;
                }
            }

            // ìš°ì„ ìˆœìœ„ í•„í„° ì¶”ê°€
            if (priorityFilter) {
                url += `&priority=${priorityFilter}`;
            }

            const response = await apiRequest(url);

            if (response) {
                tasks = response.tasks || [];
                totalPages = Math.ceil((response.totalCount || 0) / size);

                await renderCalendar();
                renderTasks();
                renderPagination();
            }
        } catch (error) {
            showNotification('ì‘ì—… ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        } finally {
            showLoading(false);
        }
    }

    // í˜„ì¬ ë·°ì˜ ë‚ ì§œ ë²”ìœ„ë¥¼ ë°˜í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
    function getCurrentViewDateRange() {
        const start = new Date(currentDate);
        const end = new Date(currentDate);

        if (currentView === 'month') {
            // ì›”ê°„: í•´ë‹¹ ì›”ì˜ ì²«ë‚  ~ ë§ˆì§€ë§‰ë‚ 
            start.setDate(1);
            end.setMonth(end.getMonth() + 1);
            end.setDate(0);
        } else if (currentView === 'week') {
            // ì£¼ê°„: í•´ë‹¹ ì£¼ì˜ ì¼ìš”ì¼ ~ í† ìš”ì¼
            const weekStart = getWeekStart(currentDate);
            start.setTime(weekStart.getTime());
            end.setTime(weekStart.getTime());
            end.setDate(end.getDate() + 6);
        } else if (currentView === 'year') {
            // ë…„ê°„: í•´ë‹¹ ë…„ì˜ 1ì›” 1ì¼ ~ 12ì›” 31ì¼
            start.setMonth(0, 1);
            end.setMonth(11, 31);
        }

        return { start, end };
    }

    // API ìš”ì²­ìš© ë‚ ì§œ í¬ë§· (yyyy-MM-dd)
    function formatDateForApi(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    async function createTask(taskData) {
        try {
            showLoading(true);
            const response = await apiRequest(API_BASE_URL, {
                method: 'POST',
                body: JSON.stringify(taskData)
            });

            if (response) {
                showNotification('ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                await loadTasks();
                closeTaskModal();
            }
        } catch (error) {
            showNotification('ì‘ì—… ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function updateTask(taskId, taskData) {
        try {
            showLoading(true);
            const response = await apiRequest(`${API_BASE_URL}/${taskId}`, {
                method: 'PUT',
                body: JSON.stringify(taskData)
            });

            if (response) {
                showNotification('ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                await loadTasks();
                closeTaskModal();
            }
        } catch (error) {
            showNotification('ì‘ì—… ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function deleteTask(taskId) {
        if (!confirm('ì´ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        try {
            showLoading(true);
            await apiRequest(`${API_BASE_URL}/${taskId}`, {
                method: 'DELETE'
            });

            showNotification('ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            await loadTasks();
        } catch (error) {
            showNotification('ì‘ì—… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function updateTaskStatus(taskId, status) {
        try {
            showLoading(true);
            const response = await apiRequest(`${API_BASE_URL}/${taskId}/status?status=${status}`, {
                method: 'PATCH'
            });

            if (response) {
                const statusText = status === 'COMPLETED' ? 'ì™„ë£Œ' : 'ìƒíƒœ ë³€ê²½';
                showNotification(`ì‘ì—…ì´ ${statusText}ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                await loadTasks();
            }
        } catch (error) {
            showNotification('ì‘ì—… ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
        } finally {
            showLoading(false);
        }
    }

    async function searchTasks() {
        // loadTasksê°€ ì´ë¯¸ í•„í„°ì™€ ë‚ ì§œ ë²”ìœ„ë¥¼ ëª¨ë‘ ì²˜ë¦¬í•˜ë¯€ë¡œ ë‹¨ìˆœíˆ í˜¸ì¶œ
        await loadTasks();
    }

    // ë‹¬ë ¥ ë Œë”ë§
    async function renderCalendar() {
        if (currentView === 'month') {
            await renderMonthCalendar();
        } else if (currentView === 'week') {
            await renderWeekCalendar();
        } else if (currentView === 'year') {
            await renderYearCalendar();
        }
        updateCalendarTitle();
    }

    // async function loadTaskWithCategories(task) {
    //     try {
    //         const response = await fetch(`/api/tasks/${task.id}/categories`);
    //         const taskCategories = await response.json();
    //         return { ...task, categories: taskCategories };
    //     } catch (error) {
    //         console.error('ì‘ì—… ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
    //         return { ...task, categories: [] };
    //     }
    // }

    async function renderMonthCalendar() {
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());

        const tbody = document.getElementById('monthCalendarBody');
        tbody.innerHTML = '';

        let currentWeek = startDate;

        // ëª¨ë“  ì‘ì—…ì˜ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ë¯¸ë¦¬ ë¡œë“œ
        // const tasksWithCategories = await Promise.all(
        //     tasks.map(task => loadTaskWithCategories(task))
        // );
        const tasksWithCategories = tasks;

        for (let week = 0; week < 6; week++) {
            const tr = document.createElement('tr');

            for (let day = 0; day < 7; day++) {
                const td = document.createElement('td');
                const dateNum = currentWeek.getDate();
                const isCurrentMonth = currentWeek.getMonth() === currentDate.getMonth();
                const isToday = isDateToday(currentWeek);
                const dateStr = formatDateForInput(currentWeek);

                // í•´ë‹¹ ë‚ ì§œì˜ ì‘ì—… í•„í„°ë§
                const dayTasks = tasksWithCategories.filter(task =>
                    task.startDate <= dateStr && task.endDate >= dateStr
                );

                const currentDateCopy = new Date(currentWeek);

                // ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ê¸°ë°˜ ì¸ë””ì¼€ì´í„° ìƒì„±
                const taskIndicators = dayTasks.map(task => {
                    const isCompleted = task.status === 'COMPLETED';
                    const opacity = isCompleted ? '0.3' : '1';

                    // ì‘ì—…ì˜ ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ì‚¬ìš© (ì—†ìœ¼ë©´ ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ)
                    let color = '';
                    if (task.categories && task.categories.length > 0) {
                        color = task.categories[0].colorCode;
                    } else {
                        // ì¹´í…Œê³ ë¦¬ê°€ ì—†ìœ¼ë©´ ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ ì‚¬ìš©
                        const priorityColors = {
                            'LOW': '#28a745',
                            'MEDIUM': '#ffc107',
                            'HIGH': '#fd7e14',
                            'URGENT': '#dc3545'
                        };
                        color = priorityColors[task.priority] || '#6c757d';
                    }

                    return `<span class="task-indicator" style="background: ${color}; opacity: ${opacity};"></span>`;
                }).join('');

                td.innerHTML = `
                <div class="date-number">${dateNum}</div>
                ${taskIndicators}
            `;

                if (!isCurrentMonth) {
                    td.classList.add('other-month');
                }
                if (isToday) {
                    td.classList.add('today');
                }
                if (dayTasks.length > 0) {
                    td.classList.add('has-tasks');

                    // ì™„ë£Œë˜ì§€ ì•Šì€ ì‘ì—… ì¤‘ ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒìœ¼ë¡œ ë³´ë” ì„¤ì •
                    const incompleteTasks = dayTasks.filter(t => t.status !== 'COMPLETED');
                    if (incompleteTasks.length > 0 && incompleteTasks[0].categories && incompleteTasks[0].categories.length > 0) {
                        td.style.borderLeft = `4px solid ${incompleteTasks[0].categories[0].colorCode}`;
                    }
                }

                td.addEventListener('click', () => selectDateForView(new Date(currentDateCopy)));
                td.addEventListener('dblclick', () => addTaskForDate(new Date(currentDateCopy)));

                tr.appendChild(td);
                currentWeek.setDate(currentWeek.getDate() + 1);
            }

            tbody.appendChild(tr);
        }
    }


    // ì£¼ê°„ ë‹¬ë ¥ ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì •
    async function renderWeekCalendar() {
        const weekStart = getWeekStart(currentDate);
        const weekBody = document.getElementById('weekCalendarBody');
        weekBody.innerHTML = '';

        // ëª¨ë“  ì‘ì—…ì˜ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ë¯¸ë¦¬ ë¡œë“œ
        // const tasksWithCategories = await Promise.all(
        //     tasks.map(task => loadTaskWithCategories(task))
        // );
        const tasksWithCategories = tasks;

        for (let hour = 9; hour <= 18; hour++) {
            const timeSlot = document.createElement('div');
            timeSlot.className = 'time-slot';
            timeSlot.textContent = `${hour}:00`;
            weekBody.appendChild(timeSlot);

            for (let day = 0; day < 7; day++) {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';

                const currentDay = new Date(weekStart);
                currentDay.setDate(weekStart.getDate() + day);

                if (isDateToday(currentDay)) {
                    dayColumn.classList.add('today');
                }

                const dateStr = formatDateForInput(currentDay);
                const dayTasks = tasksWithCategories.filter(task =>
                    task.startDate <= dateStr && task.endDate >= dateStr
                );

                const taskEvents = dayTasks.map(task => {
                    const isCompleted = task.status === 'COMPLETED';
                    const opacity = isCompleted ? '0.3' : '1';

                    // ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ë˜ëŠ” ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ
                    let borderColor = '';
                    if (task.categories && task.categories.length > 0) {
                        borderColor = task.categories[0].colorCode;
                    } else {
                        const priorityColors = {
                            'LOW': '#28a745',
                            'MEDIUM': '#ffc107',
                            'HIGH': '#fd7e14',
                            'URGENT': '#dc3545'
                        };
                        borderColor = priorityColors[task.priority] || '#6c757d';
                    }

                    return `<div class="task-event"
                             style="border-left: 3px solid ${borderColor}; opacity: ${opacity};"
                             onclick="selectTask(${task.id})">${escapeHtml(task.title)}</div>`;
                }).join('');

                dayColumn.innerHTML = taskEvents;
                weekBody.appendChild(dayColumn);
            }
        }
    }

    function renderYearCalendar() {
        const yearView = document.getElementById('yearView');
        yearView.innerHTML = '';

        for (let month = 0; month < 12; month++) {
            const miniMonth = document.createElement('div');
            miniMonth.className = 'mini-month';

            const monthDate = new Date(currentDate.getFullYear(), month, 1);
            const monthName = monthDate.toLocaleDateString('ko-KR', {month: 'long'});

            miniMonth.innerHTML = `
            <div class="mini-month-title">${monthName}</div>
            <table class="mini-calendar">
                <tr>
                    <td>ì¼</td><td>ì›”</td><td>í™”</td><td>ìˆ˜</td><td>ëª©</td><td>ê¸ˆ</td><td>í† </td>
                </tr>
                ${generateMiniMonthDays(monthDate)}
            </table>
        `;

            // ì›” í´ë¦­ ì´ë²¤íŠ¸ (ì œëª© ë¶€ë¶„ë§Œ)
            miniMonth.querySelector('.mini-month-title').addEventListener('click', (e) => {
                e.stopPropagation();
                currentDate = new Date(currentDate.getFullYear(), month, 1);
                changeView('month');
            });

            // ë‚ ì§œ ì…€ì— í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
            const dateCells = miniMonth.querySelectorAll('.mini-calendar td.has-tasks');
            dateCells.forEach(cell => {
                cell.addEventListener('mouseenter', (e) => {
                    const dateStr = e.target.getAttribute('data-date');
                    if (dateStr) {
                        const date = new Date(dateStr + 'T00:00:00');
                        const dayTasks = getTasksForDate(date);
                        showCustomTooltip(e.target, dayTasks);
                    }
                });

                cell.addEventListener('mouseleave', () => {
                    removeCustomTooltip();
                });
            });

            yearView.appendChild(miniMonth);
        }
    }

    function generateMiniMonthDays(monthDate) {
        const firstDay = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
        const lastDay = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());

        let html = '';
        let currentWeek = new Date(startDate);

        for (let week = 0; week < 6; week++) {
            html += '<tr>';
            for (let day = 0; day < 7; day++) {
                const dateNum = currentWeek.getDate();
                const isCurrentMonth = currentWeek.getMonth() === monthDate.getMonth();
                const isToday = isCurrentMonth && isDateToday(currentWeek);
                const dayTasks = isCurrentMonth ? getTasksForDate(currentWeek) : [];

                // ì™„ë£Œëœ ì‘ì—…ë§Œ ìˆëŠ”ì§€ í™•ì¸
                const completedTasks = dayTasks.filter(task => task.status === 'COMPLETED');
                const hasOnlyCompletedTasks = dayTasks.length > 0 && completedTasks.length === dayTasks.length;

                // ìš°ì„ ìˆœìœ„ ë¶„ì„
                let priorityClass = '';
                let taskDotClass = '';

                if (dayTasks.length > 0) {
                    if (hasOnlyCompletedTasks) {
                        // ì™„ë£Œëœ ì‘ì—…ë§Œ ìˆëŠ” ê²½ìš°
                        priorityClass = ' has-completed-only';
                        taskDotClass = ' completed';
                    } else {
                        // ë¯¸ì™„ë£Œ ì‘ì—…ì´ ìˆëŠ” ê²½ìš° ìµœê³  ìš°ì„ ìˆœìœ„ë¡œ ê²°ì •
                        const activeTasks = dayTasks.filter(task => task.status !== 'COMPLETED');
                        const priorities = activeTasks.map(task => task.priority);
                        const uniquePriorities = [...new Set(priorities)];

                        if (uniquePriorities.length === 1) {
                            // ë‹¨ì¼ ìš°ì„ ìˆœìœ„
                            priorityClass = ` priority-${uniquePriorities[0].toLowerCase()}`;
                            taskDotClass = ` priority-${uniquePriorities[0].toLowerCase()}`;
                        } else {
                            // ì—¬ëŸ¬ ìš°ì„ ìˆœìœ„ê°€ ì„ì—¬ìˆëŠ” ê²½ìš° ìµœê³  ìš°ì„ ìˆœìœ„ë¡œ í‘œì‹œ
                            const priorityOrder = ['URGENT', 'HIGH', 'MEDIUM', 'LOW'];
                            const highestPriority = priorityOrder.find(p => priorities.includes(p));
                            priorityClass = ` priority-${highestPriority.toLowerCase()}`;
                            taskDotClass = ` mixed-priority`;
                        }
                    }
                }

                const hasTasksClass = dayTasks.length > 0 ? 'has-tasks' : '';

                const taskTitles = dayTasks.map(task => {
                    const priorityIcon = getPriorityIcon(task.priority);
                    const statusIcon = getStatusIcon(task.status);
                    return `${priorityIcon} ${statusIcon} ${escapeHtml(task.title)}`;
                }).join('\n');
                const tooltipAttr = dayTasks.length > 0 ? `title="${taskTitles}"` : '';

                // ì‘ì—… ì  í‘œì‹œ
                const taskDot = dayTasks.length > 0 ?
                    `<span class="task-dot${taskDotClass}"></span>` : '';

                html += `<td class="${isToday ? 'today' : ''} ${!isCurrentMonth ? 'other-month' : ''} ${hasTasksClass}${priorityClass}"
                     onclick="selectMiniDate('${formatDateForInput(currentWeek)}')"
                     ${tooltipAttr}
                     data-date="${formatDateForInput(currentWeek)}"
                     style="position: relative;">
                     ${isCurrentMonth ? dateNum : ''}
                     ${taskDot}
                 </td>`;
                currentWeek.setDate(currentWeek.getDate() + 1);
            }
            html += '</tr>';
        }

        return html;
    }

    // ì»¤ìŠ¤í…€ íˆ´íŒ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
    function showCustomTooltip(element, tasks) {
        removeCustomTooltip();

        if (tasks.length === 0) return;

        const tooltip = document.createElement('div');
        tooltip.className = 'custom-tooltip';
        tooltip.id = 'customTooltip';

        const taskList = tasks.map(task => {
            const priorityIcon = getPriorityIcon(task.priority);
            const statusIcon = getStatusIcon(task.status);
            const isCompleted = task.status === 'COMPLETED';
            const completedClass = isCompleted ? ' completed' : '';

            return `<div class="tooltip-task${completedClass}">
                ${priorityIcon} ${statusIcon} ${escapeHtml(task.title)}
            </div>`;
        }).join('');

        tooltip.innerHTML = `
        <div class="tooltip-header">ğŸ“‹ ì‘ì—… ëª©ë¡ (${tasks.length}ê°œ)</div>
        ${taskList}
    `;

        document.body.appendChild(tooltip);

        // íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°
        const rect = element.getBoundingClientRect();
        const tooltipRect = tooltip.getBoundingClientRect();

        let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
        let top = rect.top - tooltipRect.height - 10;

        // í™”ë©´ ê²½ê³„ ì²˜ë¦¬
        if (left < 10) left = 10;
        if (left + tooltipRect.width > window.innerWidth - 10) {
            left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top < 10) {
            top = rect.bottom + 10;
        }

        tooltip.style.left = left + 'px';
        tooltip.style.top = top + 'px';
        tooltip.style.opacity = '1';
    }

    // ì»¤ìŠ¤í…€ íˆ´íŒ ì œê±° í•¨ìˆ˜
    function removeCustomTooltip() {
        const existingTooltip = document.getElementById('customTooltip');
        if (existingTooltip) {
            existingTooltip.remove();
        }
    }

    // ìš°ì„ ìˆœìœ„ ì•„ì´ì½˜ ë°˜í™˜ í•¨ìˆ˜
    function getPriorityIcon(priority) {
        const priorityIcons = {
            'LOW': 'ğŸŸ¢',
            'MEDIUM': 'ğŸŸ¡',
            'HIGH': 'ğŸŸ ',
            'URGENT': 'ğŸ”´'
        };
        return priorityIcons[priority] || 'âšª';
    }

    // ìƒíƒœ ì•„ì´ì½˜ ë°˜í™˜ í•¨ìˆ˜
    function getStatusIcon(status) {
        const statusIcons = {
            'TODO': 'ğŸ“',
            'IN_PROGRESS': 'â³',
            'COMPLETED': 'âœ…'
        };
        return statusIcons[status] || 'ğŸ“‹';
    }

    function selectMiniDate(dateStr) {
        const date = new Date(dateStr + 'T00:00:00');
        currentDate = new Date(date);
        changeView('month');
        selectDateForView(date);
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function isDateToday(date) {
        const today = new Date();
        return date.toDateString() === today.toDateString();
    }

    function getWeekStart(date) {
        const start = new Date(date);
        start.setDate(date.getDate() - date.getDay());
        return start;
    }

    function getTasksForDate(date) {
        const dateStr = formatDateForInput(date);

        return tasks.filter(task =>
            task.startDate <= dateStr && task.endDate >= dateStr
        );
    }

    function selectDateForView(date) {
        selectedDate = new Date(date);
        currentDate = new Date(date);

        document.querySelectorAll('.calendar td').forEach(td => {
            td.classList.remove('selected-date');
        });

        const targetCell = event.currentTarget;
        if (targetCell) {
            targetCell.classList.add('selected-date');
        }

        renderTasksForSelectedDate(date);
    }

    function addTaskForDate(date) {
        selectedDate = new Date(date);
        openTaskModalForDate(date);
    }

    function openTaskModalForDate(date) {
        editingTaskId = null;
        document.getElementById('modalTitle').textContent = `ìƒˆ ì‘ì—… ë“±ë¡ - ${date.toLocaleDateString('ko-KR')}`;
        document.getElementById('taskForm').reset();

        const dateStr = formatDateForInput(date);

        document.getElementById('startDate').value = dateStr;
        document.getElementById('endDate').value = dateStr;

        document.getElementById('taskModal').style.display = 'block';

        setTimeout(() => {
            document.getElementById('title').focus();
        }, 100);
    }

    function renderTasksForSelectedDate(date) {
        if (!date) {
            renderTasks();
            return;
        }

        const taskList = document.getElementById('taskList');
        const emptyState = document.getElementById('emptyState');
        const pagination = document.getElementById('pagination');

        const dateStr = formatDateForInput(date);

        const dateTasks = tasks.filter(task =>
            task.startDate <= dateStr && task.endDate >= dateStr
        );

        let filteredTasks = dateTasks.filter(task => {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;

            // ìƒíƒœ í•„í„° ì²˜ë¦¬
            let matchesStatus = true;
            if (statusFilter) {
                if (statusFilter.includes(',')) {
                    // ì—¬ëŸ¬ ìƒíƒœë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš° (ì˜ˆ: "TODO,IN_PROGRESS")
                    const allowedStatuses = statusFilter.split(',');
                    matchesStatus = allowedStatuses.includes(task.status);
                } else {
                    // ë‹¨ì¼ ìƒíƒœì¸ ê²½ìš°
                    matchesStatus = task.status === statusFilter;
                }
            }

            const matchesPriority = !priorityFilter || task.priority === priorityFilter;
            return matchesStatus && matchesPriority;
        });

        filteredTasks = getSortedTasks(filteredTasks);

        pagination.style.display = 'none';

        if (filteredTasks.length === 0) {
            taskList.style.display = 'none';
            emptyState.style.display = 'block';
            emptyState.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“…</div>
                <h3>${date.toLocaleDateString('ko-KR')}ì— ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¬ë ¥ì˜ ë‚ ì§œë¥¼ ë”ë¸”í´ë¦­í•˜ê±°ë‚˜ ìƒˆ ì‘ì—… ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‘ì—…ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
            `;
            return;
        }

        taskList.style.display = 'block';
        emptyState.style.display = 'none';

        // ìˆ˜ì •ëœ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì„ íƒëœ ë‚ ì§œì˜ ì‘ì—… ëª©ë¡ ìƒì„± (7ê°œ ì»¬ëŸ¼)
        const tableHtml = `
            <div class="period-header">
                <h3>ğŸ“… ${date.toLocaleDateString('ko-KR', {
            month: 'short',
            day: 'numeric',
            weekday: 'short'
        })} (ì´ ${filteredTasks.length}ê°œ)</h3>
            </div>
            <div class="task-table-container">
                <table class="task-table">
                    <thead>
                        <tr>
                            <th class="th-title">ì‘ì—…ëª…</th>
                            <th class="th-author">ì‘ì„±ì</th>
                            <th class="th-date">ê¸°ê°„</th>
                            <th class="th-priority">ìš°ì„ ìˆœìœ„</th>
                            <th class="th-status">ìƒíƒœ</th>
                            <th class="th-overdue">ì§€ì—°</th>
                            <th class="th-actions">ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredTasks.map(task => createTaskElement(task)).join('')}
                    </tbody>
                </table>
            </div>
        `;

        taskList.innerHTML = tableHtml;
    }


    function updateCalendarTitle() {
        const titleElement = document.getElementById('calendarTitle');

        if (currentView === 'month') {
            titleElement.textContent = currentDate.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long'
            });
        } else if (currentView === 'week') {
            const weekStart = getWeekStart(currentDate);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            titleElement.textContent = `${weekStart.toLocaleDateString('ko-KR', {
                month: 'short',
                day: 'numeric'
            })} - ${weekEnd.toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'})}`;
        } else if (currentView === 'year') {
            titleElement.textContent = `${currentDate.getFullYear()}ë…„`;
        }
    }

    // ë‹¬ë ¥ ë„¤ë¹„ê²Œì´ì…˜
    async function navigateCalendar(direction) {
        const newDate = new Date(currentDate);

        if (currentView === 'month') {
            newDate.setMonth(newDate.getMonth() + direction);
        } else if (currentView === 'week') {
            newDate.setDate(newDate.getDate() + (7 * direction));
        } else if (currentView === 'year') {
            newDate.setFullYear(newDate.getFullYear() + direction);
        }

        currentDate = newDate;

        // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
        selectedDate = null;
        document.querySelectorAll('.calendar td').forEach(td => {
            td.classList.remove('selected-date');
        });

        // API ìš”ì²­í•˜ì—¬ ìƒˆë¡œìš´ ê¸°ê°„ì˜ ë°ì´í„° ë¡œë“œ
        await loadTasks();
    }


    async function goToToday() {
        currentDate = new Date();

        // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
        selectedDate = null;
        document.querySelectorAll('.calendar td').forEach(td => {
            td.classList.remove('selected-date');
        });

        // API ìš”ì²­í•˜ì—¬ ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ ë°ì´í„° ë¡œë“œ
        await loadTasks();
    }

    async function changeView(view) {
        currentView = view;

        document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));

        const targetBtn = document.querySelector(`[onclick="changeView('${view}')"]`);
        if (targetBtn) {
            targetBtn.classList.add('active');
        }

        document.getElementById('monthView').style.display = view === 'month' ? 'block' : 'none';
        document.getElementById('weekView').className = view === 'week' ? 'week-calendar active' : 'week-calendar';
        document.getElementById('yearView').className = view === 'year' ? 'year-calendar active' : 'year-calendar';

        // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™” (ë·° ë³€ê²½ ì‹œ í•´ë‹¹ ê¸°ê°„ì˜ ì „ì²´ ì‘ì—… í‘œì‹œ)
        selectedDate = null;
        document.querySelectorAll('.calendar td').forEach(td => {
            td.classList.remove('selected-date');
        });

        // API ìš”ì²­í•˜ì—¬ ìƒˆë¡œìš´ ë·°ì˜ ë°ì´í„° ë¡œë“œ
        await loadTasks();
    }


    function selectDate(date) {
        selectDateForView(date);
        if (currentView !== 'month') {
            changeView('month');
        } else {
            renderCalendar();
        }
    }

    // ì‘ì—… ê´€ë ¨ í•¨ìˆ˜ë“¤
    function renderTasks() {
        const taskList = document.getElementById('taskList');
        const emptyState = document.getElementById('emptyState');
        const pagination = document.getElementById('pagination');

        // ì„ íƒëœ ë‚ ì§œê°€ ìˆìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§, ì—†ìœ¼ë©´ ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„° ê·¸ëŒ€ë¡œ ì‚¬ìš©
        let displayTasks;
        if (selectedDate) {
            displayTasks = getTasksForDate(selectedDate);
        } else {
            // ì„œë²„ì—ì„œ ì´ë¯¸ ë‚ ì§œ ë²”ìœ„ì™€ í•„í„°ê°€ ì ìš©ëœ ë°ì´í„°ë¥¼ ë°›ì•˜ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            displayTasks = tasks;
        }

        displayTasks = getSortedTasks(displayTasks);

        if (displayTasks.length === 0) {
            taskList.style.display = 'none';
            emptyState.style.display = 'block';
            pagination.style.display = 'none';

            let periodText = '';
            if (selectedDate) {
                periodText = selectedDate.toLocaleDateString('ko-KR');
            } else if (currentView === 'month') {
                periodText = currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' });
            } else if (currentView === 'week') {
                const weekStart = getWeekStart(currentDate);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                periodText = `${weekStart.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })} - ${weekEnd.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}`;
            } else if (currentView === 'year') {
                periodText = `${currentDate.getFullYear()}ë…„`;
            }

            emptyState.innerHTML = `
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“</div>
            <h3>${periodText}ì— ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ìƒˆ ì‘ì—… ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‘ì—…ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
        `;
            return;
        }

        taskList.style.display = 'block';
        emptyState.style.display = 'none';
        pagination.style.display = 'none';

        // í…Œì´ë¸” í—¤ë” ìƒì„±
        let headerHtml = '';
        if (selectedDate) {
            headerHtml = `
            <div class="period-header">
                <h3>ğŸ“… ${selectedDate.toLocaleDateString('ko-KR', {
                month: 'short',
                day: 'numeric',
                weekday: 'short'
            })} (ì´ ${displayTasks.length}ê°œ)</h3>
            </div>
        `;
        } else {
            let periodInfo = '';
            let icon = '';

            if (currentView === 'month') {
                periodInfo = currentDate.toLocaleDateString('ko-KR', { month: 'long' });
                icon = 'ğŸ“…';
            } else if (currentView === 'week') {
                const weekStart = getWeekStart(currentDate);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                periodInfo = `${weekStart.getDate()}ì¼-${weekEnd.getDate()}ì¼`;
                icon = 'ğŸ“Š';
            } else if (currentView === 'year') {
                periodInfo = `${currentDate.getFullYear()}ë…„`;
                icon = 'ğŸ“‹';
            }

            headerHtml = `
            <div class="period-header">
                <h3>${icon} ${periodInfo} (ì´ ${displayTasks.length}ê°œ)</h3>
            </div>
        `;
        }

        // ìˆ˜ì •ëœ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì‘ì—… ëª©ë¡ ìƒì„± (7ê°œ ì»¬ëŸ¼)
        const tableHtml = `
        ${headerHtml}
        <div class="task-table-container">
            <table class="task-table">
                <thead>
                    <tr>
                        <th class="th-title">ì‘ì—…ëª…</th>
                        <th class="th-author">ì‘ì„±ì</th>
                        <th class="th-date">ê¸°ê°„</th>
                        <th class="th-priority">ìš°ì„ ìˆœìœ„</th>
                        <th class="th-status">ìƒíƒœ</th>
                        <th class="th-overdue">ì§€ì—°</th>
                        <th class="th-actions">ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody>
                    ${displayTasks.map(task => createTaskElement(task)).join('')}
                </tbody>
            </table>
        </div>
    `;

        taskList.innerHTML = tableHtml;
    }


    function renderPagination() {
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
            pagination.style.display = 'none';
            return;
        }

        pagination.style.display = 'flex';
        pagination.innerHTML = '';

        // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'ì´ì „';
        prevBtn.disabled = currentPage === 0;
        prevBtn.onclick = () => changePage(currentPage - 1);
        pagination.appendChild(prevBtn);

        // í˜ì´ì§€ ë²ˆí˜¸ë“¤
        const startPage = Math.max(0, currentPage - 2);
        const endPage = Math.min(totalPages - 1, currentPage + 2);

        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.textContent = i + 1;
            pageBtn.className = i === currentPage ? 'active' : '';
            pageBtn.onclick = () => changePage(i);
            pagination.appendChild(pageBtn);
        }

        // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'ë‹¤ìŒ';
        nextBtn.disabled = currentPage === totalPages - 1;
        nextBtn.onclick = () => changePage(currentPage + 1);
        pagination.appendChild(nextBtn);
    }

    // í˜„ì¬ ë·° ê¸°ê°„ì— í•´ë‹¹í•˜ëŠ” ì‘ì—…ë“¤ë§Œ í•„í„°ë§í•˜ëŠ” í•¨ìˆ˜
    function getTasksForCurrentPeriod() {
        if (currentView === 'month') {
            return getTasksForMonth(currentDate);
        } else if (currentView === 'week') {
            return getTasksForWeek(currentDate);
        } else if (currentView === 'year') {
            return getTasksForYear(currentDate);
        }
        return tasks;
    }

    // íŠ¹ì • ì›”ì˜ ì‘ì—…ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function getTasksForMonth(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        const firstDayStr = formatDateForInput(firstDay);
        const lastDayStr = formatDateForInput(lastDay);

        return tasks.filter(task => {
            // ì‘ì—… ê¸°ê°„ì´ í•´ë‹¹ ì›”ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
            return task.startDate <= lastDayStr && task.endDate >= firstDayStr;
        });
    }

    // íŠ¹ì • ì£¼ì˜ ì‘ì—…ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function getTasksForWeek(date) {
        const weekStart = getWeekStart(date);
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);

        const weekStartStr = formatDateForInput(weekStart);
        const weekEndStr = formatDateForInput(weekEnd);

        return tasks.filter(task => {
            // ì‘ì—… ê¸°ê°„ì´ í•´ë‹¹ ì£¼ì™€ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
            return task.startDate <= weekEndStr && task.endDate >= weekStartStr;
        });
    }

    // íŠ¹ì • ë…„ì˜ ì‘ì—…ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function getTasksForYear(date) {
        const year = date.getFullYear();
        const firstDay = new Date(year, 0, 1);
        const lastDay = new Date(year, 11, 31);

        const firstDayStr = formatDateForInput(firstDay);
        const lastDayStr = formatDateForInput(lastDay);

        return tasks.filter(task => {
            // ì‘ì—… ê¸°ê°„ì´ í•´ë‹¹ ë…„ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
            return task.startDate <= lastDayStr && task.endDate >= firstDayStr;
        });
    }

    function changePage(page) {
        if (page >= 0 && page < totalPages) {
            currentPage = page;
            if (selectedDate) {
                renderTasksForSelectedDate(selectedDate);
            } else {
                loadTasks();
            }
        }
    }

    function createTaskElement(task) {
        const isOverdue = new Date(task.endDate) < new Date() && task.status !== 'COMPLETED';
        const priorityClass = task.priority.toLowerCase();
        const statusClass = task.status.toLowerCase().replace('_', '-');
        const isCompleted = task.status === 'COMPLETED';

        // categoriesê°€ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ì˜ colorCode ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ priority ìƒ‰ìƒ ì‚¬ìš©
        const borderColor = task.categories && task.categories.length > 0
            ? task.categories[0].colorCode
            : null;

        const borderStyle = borderColor ? `style="border-left: 3px solid ${borderColor};"` : "";

        return `
            <tr class="task-row priority-${priorityClass} ${isOverdue ? 'overdue' : ''} ${isCompleted ? 'completed' : ''}" ${borderStyle}
                onclick="editTask(${task.id})">
                <td class="task-title-cell">
                    <div class="task-title-content">
                        <span class="task-title">${escapeHtml(task.title)}</span>
                        ${task.description ? `<span class="task-description">${escapeHtml(task.description)}</span>` : ''}
                    </div>
                </td>
                <td class="task-author-cell">${escapeHtml(task.authorName)}</td>
                <td class="task-date-cell">
                    <div class="task-dates">
                        <span>${formatDate(task.startDate)} ~ ${formatDate(task.endDate)}</span>
                    </div>
                </td>
                <td class="task-priority-cell">
                    <span class="priority-badge priority-${priorityClass}">
                        ${getPriorityText(task.priority)}
                    </span>
                </td>
                <td class="task-status-cell">
                    <span class="status-badge status-${statusClass}">
                        ${getStatusText(task.status)}
                    </span>
                </td>
                <td class="task-overdue-cell">
                    ${isOverdue ? '<span class="overdue-badge">ì§€ì—°</span>' : '<span class="on-time-badge">ì •ìƒ</span>'}
                </td>
                <td class="task-actions-cell" onclick="event.stopPropagation();">
                    <div class="task-actions">
                        <button class="btn-small btn-delete" onclick="deleteTask(${task.id})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                        ${task.status !== 'COMPLETED' ?
            `<button class="btn-small btn-complete" onclick="completeTask(${task.id})" title="ì™„ë£Œ">âœ…</button>` :
            ''
        }
                    </div>
                </td>
            </tr>
        `;
    }

    function editTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;

        editingTaskId = taskId;
        document.getElementById('modalTitle').textContent = 'ì‘ì—… ìˆ˜ì •';

        document.getElementById('title').value = task.title;
        document.getElementById('description').value = task.description || '';
        document.getElementById('startDate').value = task.startDate;
        document.getElementById('endDate').value = task.endDate;
        document.getElementById('priority').value = task.priority;
        document.getElementById('status').value = task.status;

        // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ë Œë”ë§ ë° ì„ íƒ
        renderCategoryCheckboxes();
        if (task.categories && task.categories.length > 0) {
            const categoryIds = task.categories.map(cat => cat.id);
            setSelectedCategories(categoryIds);
        }

        document.getElementById('taskModal').style.display = 'block';

        setTimeout(() => {
            const titleInput = document.getElementById('title');
            titleInput.focus();
            titleInput.select();
        }, 100);
    }

    function completeTask(taskId) {
        updateTaskStatus(taskId, 'COMPLETED');
    }

    function getSortedTasks(tasksToSort) {
        const sortBy = document.getElementById('sortSelect').value;

        return [...tasksToSort].sort((a, b) => {
            if (sortBy === 'endDate') {
                return new Date(a.endDate) - new Date(b.endDate);
            } else if (sortBy === 'priority') {
                const priorityOrder = {URGENT: 4, HIGH: 3, MEDIUM: 2, LOW: 1};
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            } else if (sortBy === 'createdAt') {
                return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
            }
            return 0;
        });
    }

    function selectTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;

        const taskDate = new Date(task.startDate);
        currentDate = new Date(taskDate);

        if (currentView !== 'month') {
            changeView('month');
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.view-btn[onclick="changeView(\'month\')"]').classList.add('active');
        } else {
            renderCalendar();
        }

        setTimeout(() => {
            const taskElements = document.querySelectorAll('.task-item');
            taskElements.forEach(el => el.style.background = 'white');

            const selectedTaskElement = document.querySelector(`[onclick="selectTask(${taskId})"]`);
            if (selectedTaskElement) {
                selectedTaskElement.style.background = 'linear-gradient(135deg, #fff 0%, #e3f2fd 100%)';
                selectedTaskElement.scrollIntoView({behavior: 'smooth', block: 'center'});
            }
        }, 300);
    }

    function sortTasks() {
        if (selectedDate) {
            renderTasksForSelectedDate(selectedDate);
        } else {
            renderTasks();
        }
    }

    async function filterTasks() {
        currentPage = 0;
        if (selectedDate) {
            renderTasksForSelectedDate(selectedDate);
        } else {
            await searchTasks();
        }
    }

    function showAllTasks() {
        selectedDate = null;
        currentPage = 0;
        document.querySelectorAll('.calendar td').forEach(td => {
            td.classList.remove('selected-date');
        });

        // í•„í„° ì´ˆê¸°í™”
        document.getElementById('statusFilter').value = '';
        document.getElementById('priorityFilter').value = '';

        // ì „ì²´ ì‘ì—…ì„ ë³´ê¸° ìœ„í•´ APIì—ì„œ ë‹¤ì‹œ ë¡œë“œ
        loadTasks();
    }

    // ì‘ì—… CRUD í•¨ìˆ˜ë“¤
    function openTaskModal() {
        editingTaskId = null;

        if (selectedDate) {
            document.getElementById('modalTitle').textContent = `ìƒˆ ì‘ì—… ë“±ë¡ - ${selectedDate.toLocaleDateString('ko-KR')}`;
            const dateStr = formatDateForInput(selectedDate);
            document.getElementById('startDate').value = dateStr;
            document.getElementById('endDate').value = dateStr;
        } else {
            document.getElementById('modalTitle').textContent = 'ìƒˆ ì‘ì—… ë“±ë¡';
            setDefaultDates();
        }

        document.getElementById('taskForm').reset();

        if (selectedDate) {
            const dateStr = formatDateForInput(selectedDate);
            document.getElementById('startDate').value = dateStr;
            document.getElementById('endDate').value = dateStr;
        } else {
            setDefaultDates();
        }

        // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ë Œë”ë§
        renderCategoryCheckboxes();
        resetCategoryCheckboxes();

        document.getElementById('taskModal').style.display = 'block';

        setTimeout(() => {
            document.getElementById('title').focus();
        }, 100);
    }

    function closeTaskModal() {
        document.getElementById('taskModal').style.display = 'none';
        editingTaskId = null;

        // ë“œë¡­ë‹¤ìš´ ë‹«ê¸° ì¶”ê°€
        const container = document.getElementById('categoryCheckboxList');
        const header = document.querySelector('.category-dropdown-header');
        const arrow = document.querySelector('.category-dropdown-arrow');

        if (container.classList.contains('open')) {
            container.classList.remove('open');
            header.classList.remove('active');
            arrow.classList.remove('open');
        }
    }

    function setDefaultDates() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);

        document.getElementById('startDate').value = formatDateForInput(today);
        document.getElementById('endDate').value = formatDateForInput(tomorrow);
    }

    function saveTask(event) {
        event.preventDefault();

        const taskData = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            startDate: document.getElementById('startDate').value,
            endDate: document.getElementById('endDate').value,
            priority: document.getElementById('priority').value,
            status: document.getElementById('status').value,
            categoryIds: getSelectedCategoryIds()  // ì¹´í…Œê³ ë¦¬ ID ì¶”ê°€
        };

        const errors = validateTaskData(taskData);
        if (errors.length > 0) {
            alert(errors.join('\n'));
            return;
        }

        if (editingTaskId) {
            updateTask(editingTaskId, taskData);
        } else {
            createTask(taskData);
        }
    }

    function renderCategoryCheckboxes() {
        const container = document.getElementById('categoryCheckboxList');

        if (!categories || categories.length === 0) {
            container.innerHTML = '<p style="color: #6c757d; font-size: 0.9rem;">ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        container.innerHTML = categories
            .filter(cat => cat.isActive)  // í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ë§Œ í‘œì‹œ
            .map(category => `
            <div class="category-checkbox-item" data-category-id="${category.id}">
                <input
                    type="checkbox"
                    id="category-${category.id}"
                    value="${category.id}"
                    onchange="toggleCategorySelection(${category.id})"
                >
                <label for="category-${category.id}" class="category-checkbox-label">
                    <span class="category-color-indicator" style="background-color: ${category.colorCode || '#6c757d'}"></span>
                    <span>${escapeHtml(category.name)}</span>
                </label>
            </div>
        `).join('');
    }

    function toggleCategoryDropdown() {
        const container = document.getElementById('categoryCheckboxList');
        const header = document.querySelector('.category-dropdown-header');
        const arrow = document.querySelector('.category-dropdown-arrow');

        container.classList.toggle('open');
        header.classList.toggle('active');
        arrow.classList.toggle('open');
    }

    // ì¹´í…Œê³ ë¦¬ ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì¶”ê°€)
    function updateCategoryDisplay() {
        const checkboxes = document.querySelectorAll('#categoryCheckboxList input[type="checkbox"]:checked');
        const count = checkboxes.length;
        const textElement = document.getElementById('categorySelectedText');
        const countElement = document.getElementById('categorySelectedCount');

        if (count === 0) {
            textElement.textContent = 'ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì—†ìŒ';
            countElement.style.display = 'none';
        } else if (count === 1) {
            const label = checkboxes[0].nextElementSibling.querySelector('span:last-child').textContent;
            textElement.textContent = label;
            countElement.style.display = 'none';
        } else {
            textElement.textContent = 'ì¹´í…Œê³ ë¦¬ ì„ íƒë¨';
            countElement.textContent = count;
            countElement.style.display = 'inline-block';
        }
    }

    // ê¸°ì¡´ toggleCategorySelection í•¨ìˆ˜ ìˆ˜ì •
    function toggleCategorySelection(categoryId) {
        const item = document.querySelector(`.category-checkbox-item[data-category-id="${categoryId}"]`);
        const checkbox = document.getElementById(`category-${categoryId}`);

        if (checkbox.checked) {
            item.classList.add('selected');
        } else {
            item.classList.remove('selected');
        }

        // ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸ ì¶”ê°€
        updateCategoryDisplay();
    }

    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    function getSelectedCategoryIds() {
        const checkboxes = document.querySelectorAll('#categoryCheckboxList input[type="checkbox"]:checked');
        return Array.from(checkboxes).map(cb => parseInt(cb.value));
    }

    // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
    function resetCategoryCheckboxes() {
        const checkboxes = document.querySelectorAll('#categoryCheckboxList input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
            const item = checkbox.closest('.category-checkbox-item');
            if (item) {
                item.classList.remove('selected');
            }
        });

        // ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸ ì¶”ê°€
        updateCategoryDisplay();
    }

    // ê¸°ì¡´ setSelectedCategories í•¨ìˆ˜ ìˆ˜ì •
    function setSelectedCategories(categoryIds) {
        resetCategoryCheckboxes();

        if (!categoryIds || categoryIds.length === 0) {
            return;
        }

        categoryIds.forEach(categoryId => {
            const checkbox = document.getElementById(`category-${categoryId}`);
            if (checkbox) {
                checkbox.checked = true;
                const item = checkbox.closest('.category-checkbox-item');
                if (item) {
                    item.classList.add('selected');
                }
            }
        });

        // ì„ íƒ í‘œì‹œ ì—…ë°ì´íŠ¸ ì¶”ê°€
        updateCategoryDisplay();
    }


    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR', {
            month: 'short',
            day: 'numeric'
        });
    }

    function getPriorityText(priority) {
        const priorityMap = {
            'LOW': 'ë‚®ìŒ',
            'MEDIUM': 'ë³´í†µ',
            'HIGH': 'ë†’ìŒ',
            'URGENT': 'ê¸´ê¸‰'
        };
        return priorityMap[priority] || priority;
    }

    function getStatusText(status) {
        const statusMap = {
            'TODO': 'í•  ì¼',
            'IN_PROGRESS': 'ì§„í–‰ ì¤‘',
            'COMPLETED': 'ì™„ë£Œ'
        };
        return statusMap[status] || status;
    }

    function formatDateForInput(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    function validateTaskData(taskData) {
        const errors = [];

        if (!taskData.title.trim()) {
            errors.push('ì‘ì—… ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        }

        if (new Date(taskData.endDate) < new Date(taskData.startDate)) {
            errors.push('ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        }

        return errors;
    }

    function showLoading(show) {
        const container = document.querySelector('.container');
        if (show) {
            container.classList.add('loading');
        } else {
            container.classList.remove('loading');
        }
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function (event) {
        const modal = document.getElementById('taskModal');
        if (event.target === modal) {
            closeTaskModal();
        }
    }

    document.addEventListener('keydown', function(event) {
        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        if (event.key === 'Escape') {
            const modal = document.getElementById('taskModal');
            if (modal.style.display === 'block') {
                closeTaskModal();
            }
        }
    });
</script>
</body>
</html>